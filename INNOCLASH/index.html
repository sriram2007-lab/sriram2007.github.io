<!DOCTYPE html>
<html>
<head>
    <title>TESLA</title>
    <link rel="stylesheet" href="style.css">

    <style>
        body {
            background-image: url("image.jpg");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        .box { display: none; }
        #startBox { display: flex; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>

<body>

<h1>Family Energy & Carbon Calculator</h1>

<!-- START -->
<div class="box" id="startBox">
    <p>Small acts, when multiplied by millions of people, can transform the world.</p>
    <button onclick="showSection('electricityBox')">Start Calculation</button>
</div>

<!-- ELECTRICITY -->
<div class="box" id="electricityBox">
    <h2>Electricity Usage</h2>

    <label>Number of Family Members</label>
    <input type="number" id="members">

    <label>Number of Fans</label>
    <input type="number" id="fans">

    <label>LED Lights</label>
    <input type="number" id="led">

    <label>Non-LED Lights</label>
    <input type="number" id="nonled">

    <label>Refrigerator Runtime (hrs/day)</label>
    <input type="number" id="fridge">

    <label>AC Runtime (hrs/day)</label>
    <input type="number" id="ac">

    <label>TV Runtime (hrs/day)</label>
    <input type="number" id="tv">

    <label>Washing Machine Usage (hrs/day)</label>
    <input type="number" id="wm">

    <label>Heater Usage (hrs/day)</label>
    <input type="number" id="heater">

    <label>EV Charging Electricity (kWh/day)</label>
    <input type="number" id="evPower">

    <button onclick="showSection('startBox')">Back</button>
    <button onclick="calculateElectricity(); showSection('fuelBox')">Next</button>
</div>

<!-- FUEL -->
<div class="box" id="fuelBox">
    <h2>Fuel Consumption</h2>

    <label>Select Vehicle Type</label>
    <select id="vehicleType" onchange="toggleFuelOptions()">
        <option value="">-- Select --</option>
        <option value="bike">Bike</option>
        <option value="car">Car</option>
        <option value="both">Bike + Car</option>
    </select>

    <div id="bikeBox" style="display:none;">
        <label>Number of Bikes</label>
        <input type="number" id="numBikes">
        <div id="bikeInputs"></div>
        <button onclick="addBikeInputs()">Add Bike Details</button>
    </div>

    <div id="carBox" style="display:none;">
        <label>Number of Cars</label>
        <input type="number" id="numCars">
        <div id="carInputs"></div>
        <button onclick="addCarInputs()">Add Car Details</button>
    </div>

    <button onclick="showSection('electricityBox')">Back</button>
    <button onclick="calculateFuel(); showSection('waterBox')">Next</button>
</div>

<!-- WATER -->
<div class="box" id="waterBox">
    <h2>Water Usage</h2>

    <label>Number of Family Members</label>
    <input type="number" id="waterMembers">

    <label>Source of Water</label>
    <select id="waterSource">
        <option value="">-- Select --</option>
        <option value="municipal">Municipal</option>
        <option value="borewell">Borewell</option>
        <option value="private">Private</option>
    </select>

    <label>Water Consumed (liters/day)</label>
    <input type="number" id="waterUsed">

    <button onclick="showSection('fuelBox')">Back</button>
    <button onclick="finishCalculation()">Finish</button>
</div>

<!-- RESULT -->
<div class="box" id="finishBox">
    <h2>Results</h2>
    <div id="summary"></div>
    <canvas id="circleScore" width="200" height="220"></canvas>
</div>

<script>
function showSection(id){
    document.querySelectorAll('.box').forEach(b => b.style.display='none');
    document.getElementById(id).style.display='block';
}

function toggleFuelOptions(){
    let type = vehicleType.value;
    bikeBox.style.display = (type==="bike"||type==="both")?"block":"none";
    carBox.style.display = (type==="car"||type==="both")?"block":"none";
}

let electricityKwhTotal = 0;
let totalFuelLitres = 0;
let waterUsedLitres = 0;
let members = 1;

function calculateElectricity(){
    members = Number(document.getElementById("members").value) || 1;

    electricityKwhTotal =
        fans.value * 70 * 12 / 1000 +
        led.value * 12 * 6 / 1000 +
        nonled.value * 60 * 6 / 1000 +
        fridge.value * 200 / 1000 +
        ac.value * 1500 / 1000 +
        tv.value * 100 / 1000 +
        wm.value * 500 / 1000 +
        heater.value * 3000 / 1000 +
        evPower.value * 5000 / 1000;
}

function addBikeInputs(){
    bikeInputs.innerHTML="";
    for(let i=1;i<=numBikes.value;i++){
        bikeInputs.innerHTML+=`
        <label>Bike ${i} KM/day</label>
        <input class="bikeKm">
        <label>Mileage</label>
        <input class="bikeMileage">
        `;
    }
}

function addCarInputs(){
    carInputs.innerHTML="";
    for(let i=1;i<=numCars.value;i++){
        carInputs.innerHTML+=`
        <label>Car ${i} KM/day</label>
        <input class="carKm">
        <label>Mileage</label>
        <input class="carMileage">
        `;
    }
}

/* ✅ ROBUST FUEL CALCULATION */
function calculateFuel(){
    totalFuelLitres = 0;

    const MAX_KM_PER_DAY = 1000;
    const MIN_MILEAGE = 3;
    const MAX_TOTAL_FUEL = 200;

    document.querySelectorAll(".bikeKm").forEach((k,i)=>{
        let km = Number(k.value);
        let mileage = Number(document.querySelectorAll(".bikeMileage")[i].value);

        if(Number.isFinite(km) && Number.isFinite(mileage) && km>0 && mileage>=MIN_MILEAGE){
            totalFuelLitres += Math.min(km, MAX_KM_PER_DAY) / mileage;
        }
    });

    document.querySelectorAll(".carKm").forEach((k,i)=>{
        let km = Number(k.value);
        let mileage = Number(document.querySelectorAll(".carMileage")[i].value);

        if(Number.isFinite(km) && Number.isFinite(mileage) && km>0 && mileage>=MIN_MILEAGE){
            totalFuelLitres += Math.min(km, MAX_KM_PER_DAY) / mileage;
        }
    });

    if(!Number.isFinite(totalFuelLitres)) totalFuelLitres = MAX_TOTAL_FUEL;
    totalFuelLitres = Math.min(totalFuelLitres, MAX_TOTAL_FUEL);
}

function finishCalculation(){
    waterUsedLitres = Number(waterUsed.value) || 0;

    let fuelCO2 = totalFuelLitres * 2.31;
    let eleCO2 = electricityKwhTotal * 0.85;
    let waterCO2 = waterUsedLitres * 0.0003;

    let totalCO2 = fuelCO2 + eleCO2 + waterCO2;
    let perPersonCO2 = totalCO2 / members;
    let score = Math.max(0,100-totalCO2*3);

    summary.innerHTML = `
    <b>Daily:</b> Electricity ${electricityKwhTotal.toFixed(2)} kWh |
    Fuel ${totalFuelLitres.toFixed(2)} L |
    Water ${waterUsedLitres} L <br>
    <b>CO₂:</b> ${totalCO2.toFixed(2)} kg/day |
    Per Person ${perPersonCO2.toFixed(2)} kg/day
    `;

    showSection("finishBox");
    drawCircleScore(score);
}

function drawCircleScore(p){
    let c=circleScore.getContext("2d");
    c.clearRect(0,0,200,220);

    c.beginPath();
    c.arc(100,100,80,0,2*Math.PI);
    c.strokeStyle="#ddd";
    c.lineWidth=15;
    c.stroke();

    c.beginPath();
    c.arc(100,100,80,-Math.PI/2,(p/100)*2*Math.PI-Math.PI/2);
    c.strokeStyle=p>66?"#0f9d58":p>33?"#f4b400":"#db4437";
    c.lineWidth=15;
    c.stroke();

    c.font="24px Times New Roman";
    c.textAlign="center";
    c.fillText(Math.round(p)+"%",100,105);
}
</script>

</body>
</html>
